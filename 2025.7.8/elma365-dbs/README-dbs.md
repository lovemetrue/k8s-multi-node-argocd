# Требования

kubernetes, helm v3

# Установка чарта

1. Заполнить переменные в файле `values-dbs.yaml`.

2. При использовании своих (внешних) БД установку поставляемых в этом пакете можно отключить в соответствующем поле, например для postgresql enabled - заменить `true` на `false`:
```
global:
  postgresql:
    enabled: false
```

3. При использовании внешних БД необходимо заполнить параметры подключения (connection strings) в файле values пакета elma365

4. При необходимости создать отдельный namespace для размещения БД, его необходимо будет указывать его во всех командах установки с ключом `-n`

5. При использовании кластера Kubernetes с количеством узлов три и более, можно установить БД в отказоустойчивом режиме, для этого в dbs-values.yaml удалите значки комментария `#` в разделах параметров кажой из БД после комментария `Cluster Mode`, например для MongoDB:
```
mongodb:
  ...
  architecture: replicaset
  replicaCount: 3
```

5. Для установки выполнить 
   `helm upgrade --install elma365-dbs ./elma365-dbs -f values-dbs.yaml [-n namespace]`

6. Вы можете изменить количество узлов в кластере каждой из БД, но не более чем на единицу за каждую итерацию. 

7. ВНИМАНИЕ: мы не рекомендуем *уменьшать* количество узлов в кластере PostgreSQL и MongoDB, так как в этом случае возможна частичная или полная потеря данных из-за того, что в кластере БД главный узел может в этот момент располагаться на удаляемой реплике.
